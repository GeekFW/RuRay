# RuRay v1.0.5 更新日志

## 🚀 新功能

### 网络统计监控系统
- **实时网速监控**: 实现了基于Windows API的高精度网络速度统计
  - 支持实时上传速度和下载速度监控
  - 每2秒自动更新一次网络统计数据
  - 使用Windows原生GetIfTable2 API获取准确的网络接口数据
  - 支持多网络接口的统计汇总

- **总流量统计**: 添加了累计流量统计功能
  - 从程序启动时开始记录总上传和下载流量
  - 实时计算并缓存流量数据
  - 支持长期运行的流量累计统计

- **状态栏集成**: 在前端状态栏中显示网络统计信息
  - 实时显示上传速度（红色向上箭头）
  - 实时显示下载速度（蓝色向下箭头）
  - 显示累计总流量统计
  - 支持自动单位转换（B/s, KB/s, MB/s, GB/s）

## 🔧 技术改进

### 网络统计模块架构
- 创建了`NetworkStatsManager`结构体管理网络统计
- 实现了线程安全的统计数据缓存机制
- 添加了基线统计和快照对比算法
- 支持Windows和非Windows平台的统计实现

### 定时器系统优化
- 使用`std::thread`实现稳定的定时统计任务
- 解决了异步定时器在长期运行中的稳定性问题
- 添加了定时器异常退出的监控和处理
- 实现了同步和异步版本的统计函数

### Tauri命令接口
- 新增`get_network_speed`命令接口
- 返回结构化的网络统计数据
- 支持前端实时获取网速和流量信息
- 集成到现有的系统统计API中

## 📁 文件变更

### 新增的文件
- `src-tauri/src/network.rs`: 网络统计核心模块
  - `NetworkStatsManager`结构体实现
  - Windows API网络接口统计
  - 定时器和缓存管理
  - 同步和异步统计函数

### 修改的文件
- `src-tauri/src/commands.rs`: 添加网络统计命令接口
  - 新增`get_network_speed`命令
  - 集成网络统计数据返回

- `src-tauri/src/lib.rs`: 模块导入和初始化
  - 导入网络统计模块
  - 添加网络统计管理器初始化

- `components/StatusBar.vue`: 前端状态栏组件
  - 集成网络统计数据显示
  - 添加网速和流量的实时更新
  - 优化UI显示效果

## 🎯 用户体验

### 实时监控体验
- 用户可以在状态栏实时查看当前网络使用情况
- 直观的图标和颜色区分上传下载速度
- 自动单位转换提供最佳的数据可读性
- 每秒更新确保数据的实时性

### 性能优化
- 高效的Windows API调用减少系统资源占用
- 智能的数据缓存机制避免重复计算
- 稳定的定时器实现确保长期运行稳定性

## 📋 技术细节

### Windows API集成
- 使用`GetIfTable2`函数获取网络接口统计
- 支持所有类型的网络接口（WiFi、以太网等）
- 实现了接口数据的过滤和汇总算法

### 统计算法
- 基于时间差和数据差值计算实时速度
- 使用基线统计避免程序重启时的数据跳跃
- 实现了快照对比机制确保统计准确性

### 数据结构
```rust
// 网络统计数据结构
pub struct NetworkSpeedStats {
    pub upload_speed: u64,      // 上传速度 (bytes/s)
    pub download_speed: u64,    // 下载速度 (bytes/s)
    pub total_upload: u64,      // 总上传流量 (bytes)
    pub total_download: u64,    // 总下载流量 (bytes)
}
```

---

**注意**: 网络统计功能在Windows平台上使用原生API，在其他平台上使用sysinfo库作为后备方案。