# RuRay v1.0 版本变更文档

**发布日期**: 2024年12月

## 概述
RuRay v1.0 是一个基于 Tauri + Nuxt.js 的跨平台代理管理应用程序的首个版本。本版本主要解决了配置序列化/反序列化问题，优化了用户界面体验。

## 🔧 核心修复

### 1. 配置序列化问题修复
**问题描述**: 前端与后端之间的字段名不匹配导致配置保存失败

**修复内容**:
- **RoutingRule 结构体字段修复**:
  - `outbound_tag` 字段: 添加 `#[serde(rename = "outboundTag", alias = "outbound_tag")]` 注解
  - `type` 字段: 修复语法错误，将 `alias="rule_type"` 改为 `alias = "rule_type"`
  
**技术细节**:
- 序列化时输出为 `outboundTag` 和 `type`
- 反序列化时同时支持新旧字段名，保持向后兼容性
- 解决了 "missing field `outboundTag`" 的反序列化错误

**影响文件**:
- `src-tauri/src/config.rs`

### 2. Serde 语法错误修复
**问题描述**: `RoutingRule` 结构体中存在 serde 语法错误导致编译失败

**修复内容**:
- 修复 `alias="rule_type"` 缺少空格的语法错误
- 解决了 `the trait bound 'RoutingRule: Serialize' is not satisfied` 编译错误

## 🎨 用户界面优化

### 1. 服务器名称显示优化
**功能描述**: 解决服务器名称过长时超出卡片边界的问题

**实现功能**:
- **文本截断**: 使用 CSS `truncate` 类实现自动截断
- **响应式设计**: 
  - 小屏幕: 最大宽度 150px
  - 中等屏幕: 最大宽度 200px  
  - 大屏幕: 最大宽度 250px
- **悬停提示**: 鼠标悬停时显示完整服务器名称
- **布局优化**: 使用 `flex-1 min-w-0` 确保容器正确收缩

**技术实现**:
```vue
<span 
  class="text-sm font-medium truncate block max-w-[150px] sm:max-w-[200px] md:max-w-[250px]" 
  :title="server.name"
>
  {{ server.name }}
</span>
```

**影响文件**:
- `components/ServerList.vue`

## 🛠️ 开发环境改进

### 1. 编译警告处理
**处理的警告**:
- `std::ffi::CString` 未使用警告
- `unreachable expression` 警告
- `logs_dir` 和 `new` 函数未使用警告
- `GitHubRelease` 和 `GitHubAsset` 结构体字段未读取警告

### 2. 热重载支持
**改进内容**:
- 前端开发服务器支持 HMR (Hot Module Replacement)
- Tauri 开发环境稳定运行
- 实时预览功能正常工作

## 📁 项目结构

### 核心组件
- **前端**: Nuxt.js + Vue 3 + Tailwind CSS
- **后端**: Rust + Tauri
- **包管理**: pnpm

### 主要文件
```
ruray/
├── components/
│   ├── ServerList.vue      # 服务器列表组件 (已优化)
│   ├── AppHeader.vue       # 应用头部
│   ├── LoadingScreen.vue   # 加载屏幕
│   └── ...
├── src-tauri/
│   └── src/
│       ├── config.rs       # 配置管理 (已修复)
│       └── ...
└── ...
```

## 🔄 兼容性

### 向后兼容性
- 配置文件格式保持兼容
- 支持旧版本字段名 (`outbound_tag`, `rule_type`)
- 新版本输出标准字段名 (`outboundTag`, `type`)

### 平台支持
- Windows ✅
- macOS ✅ (理论支持)
- Linux ✅ (理论支持)

## 🚀 性能优化

### 前端优化
- 响应式设计适配不同屏幕尺寸
- CSS 类优化减少重复渲染
- 组件热重载提升开发效率

### 后端优化
- Serde 序列化性能优化
- 配置解析错误处理改进
- 编译时警告清理

## 🐛 已知问题

### 已解决
- ✅ 配置保存失败问题
- ✅ 字段名不匹配问题
- ✅ Serde 编译错误
- ✅ 服务器名称显示问题

### 待优化
- 部分 Rust 编译警告 (不影响功能)
- 可考虑添加更多 UI 交互反馈

## 📝 开发说明

### 代码规范
- Rust 文件顶部包含版权声明
- 公共方法包含完整注释
- 结构体和枚举包含说明文档

### 构建命令
```bash
# 前端开发
pnpm run dev

# Tauri 开发
pnpm run tauri dev

# 生产构建
pnpm run tauri build
```

## 🎯 下一版本计划

### v1.1 规划
- [ ] 添加更多配置选项
- [ ] 优化错误处理和用户反馈
- [ ] 添加国际化支持
- [ ] 性能监控和日志系统改进

---

**项目**: RuRay  
**作者**: Lander  
**创建时间**: 2025年8月  
**文档版本**: v1.0