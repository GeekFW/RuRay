# RuRay v1.0.10 更新日志

发布日期：2025-08-30

## 🐛 问题修复

### TUN 配置加载修复
- **配置持久化问题**：修复了 TUN 配置中 `bypassIps` 字段未从配置文件正确加载的问题
- **应用启动优化**：改进了应用启动时 TUN 配置的初始化逻辑，确保从 `AppConfig` 正确加载保存的配置
- **配置同步**：修复了前端界面显示的 TUN 配置与实际保存配置不一致的问题

## 🔧 技术改进

### 后端优化
- **配置管理重构**：
  - 修改 `get_tun_config` 命令，从 `AppConfig::load()` 加载配置而非内存默认值
  - 优化 `TunManager` 初始化逻辑，在应用启动时从配置文件加载 TUN 配置
  - 添加异步配置加载机制，使用 `tauri::async_runtime::spawn` 处理配置更新
- **错误处理增强**：
  - 添加配置加载失败的错误处理和日志记录
  - 改进异步操作的错误捕获机制
- **代码清理**：
  - 移除未使用的变量，清理编译警告
  - 优化代码结构，提高可维护性

### 配置文件结构
- **窗口配置**：确认窗口初始大小配置位置在 `tauri.conf.json`
  - 默认窗口尺寸：1200x800
  - 最小窗口尺寸：800x600
  - 支持窗口居中、透明背景、自定义装饰等特性

## 📁 文件变更

### 修改文件
- `src-tauri/src/commands.rs` - 修复 `get_tun_config` 命令的配置加载逻辑
- `src-tauri/src/lib.rs` - 优化应用启动时的 TUN 配置初始化
- `src-tauri/tauri.conf.json` - 窗口配置参考文档

## 🔄 兼容性

- 保持与现有 TUN 配置格式的完全兼容
- 不影响现有用户的配置数据
- 支持从旧版本平滑升级

## 📝 技术细节

### 修复原理
1. **问题根因**：`TunManager` 在初始化时使用默认配置，未从保存的配置文件加载
2. **解决方案**：
   - 修改 `get_tun_config` 命令直接从 `AppConfig` 加载配置
   - 在应用启动时将配置文件中的 TUN 配置同步到 `TunManager`
3. **异步处理**：使用 `tauri::async_runtime::spawn` 确保配置加载不阻塞应用启动

### 配置加载流程
```rust
// 应用启动时加载配置
if let Ok(app_config) = config::AppConfig::load() {
    let tun_manager = tun::TunManager::instance();
    tauri::async_runtime::spawn(async move {
        if let Err(e) = tun_manager.update_config(app_config.tun_config).await {
            log_error!("加载TUN配置失败: {}", e);
        }
    });
}
```

---

**完整更新内容**：本版本主要修复了 TUN 配置持久化问题，确保用户保存的 `bypassIps` 等配置能够正确加载和显示。