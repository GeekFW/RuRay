# RuRay v1.0.7 更新日志

## 🚀 新功能

### 错误处理系统优化
- **TUN错误处理机制**: 全面优化TUN启动失败的错误处理和用户反馈
  - 创建统一的错误常量映射系统，替换硬编码错误信息
  - 实现错误代码到i18n键的自动映射机制
  - 提供更精确和用户友好的错误提示信息
  - 支持多语言错误信息显示

- **错误常量化管理**: 新增错误管理工具模块
  - 定义标准化的TUN错误常量（DEVICE_NOT_FOUND、PERMISSION_DENIED等）
  - 实现错误代码到i18n键的映射函数
  - 提供统一的错误处理接口
  - 支持未来错误类型的扩展

### 国际化资源完善
- **serverList模块i18n完善**: 补充完整的服务器列表相关翻译资源
  - 添加所有缺失的描述性消息键（proxyModeChangedDesc、serverAddedDesc等）
  - 补充操作失败提示信息（testFailedDesc、configTestFailedDesc等）
  - 完善错误提示信息（configInvalid、connectionFailed等）
  - 支持中文、英文、日文三种语言

- **TUN错误信息i18n**: 新增TUN相关错误的多语言支持
  - 添加设备相关错误翻译（设备未找到、权限不足等）
  - 补充配置相关错误翻译（配置无效、地址冲突等）
  - 完善网络相关错误翻译（网络不可达、连接超时等）
  - 提供系统相关错误翻译（资源不足、服务不可用等）

## 🔧 技术改进

### 错误处理架构重构
- **统一错误管理**: 在`utils/errors.js`中实现错误管理系统
  - 定义TUN错误常量枚举
  - 实现`mapTunErrorToI18nKey`错误映射函数
  - 提供标准化的错误处理流程
  - 支持错误类型的动态扩展

- **后端错误优化**: 改进`tun.rs`中的错误返回机制
  - 替换硬编码错误字符串为预定义常量
  - 统一错误返回格式和命名规范
  - 提高错误信息的准确性和一致性
  - 简化错误处理逻辑

### 前端组件优化
- **状态栏错误显示**: 优化`StatusBar.vue`中的错误处理逻辑
  - 集成错误映射函数，自动转换错误代码
  - 改进错误信息的显示方式和用户体验
  - 添加错误状态的视觉反馈
  - 支持动态语言切换时的错误信息更新

### 国际化系统增强
- **i18n资源结构优化**: 完善多语言资源的组织结构
  - 统一serverList.messages模块的键值结构
  - 添加参数占位符支持动态内容
  - 确保所有语言版本的一致性
  - 提供完整的翻译覆盖

## 📁 文件变更

### 新增的文件
- `utils/errors.js`: 错误管理工具模块
  - TUN错误常量定义
  - 错误映射函数实现
  - 错误处理工具函数

### 修改的文件
- `src-tauri/src/tun.rs`: TUN模块错误处理优化
  - 替换硬编码错误为预定义常量
  - 统一错误返回格式
  - 改进错误信息准确性

- `components/StatusBar.vue`: 状态栏错误显示优化
  - 集成错误映射机制
  - 改进错误信息显示
  - 添加错误状态反馈

- `i18n/locales/zh.json`: 中文翻译资源完善
  - 添加TUN错误相关翻译
  - 补充serverList.messages模块缺失键值
  - 完善错误提示信息翻译

- `i18n/locales/en.json`: 英文翻译资源完善
  - 添加TUN错误相关翻译
  - 补充serverList.messages模块缺失键值
  - 完善错误提示信息翻译

- `i18n/locales/ja.json`: 日文翻译资源完善
  - 添加TUN错误相关翻译
  - 补充serverList.messages模块缺失键值
  - 完善错误提示信息翻译

## 🎯 用户体验

### 错误信息体验提升
- 用户在TUN启动失败时能够获得更准确和有用的错误信息
- 错误提示支持用户当前选择的界面语言
- 提供更清晰的问题描述和可能的解决方案指引
- 减少用户因错误信息不明确而产生的困惑

### 多语言支持完善
- 所有serverList相关的操作都有完整的多语言支持
- 错误信息在不同语言环境下保持一致的表达质量
- 支持动态语言切换时的实时翻译更新
- 提供本地化的用户交互体验

### 系统稳定性提升
- 统一的错误处理机制提高了系统的健壮性
- 标准化的错误常量减少了代码维护成本
- 完善的i18n资源避免了翻译缺失导致的显示问题
- 改进的错误映射机制提高了错误处理的准确性

## 📋 技术细节

### 错误映射机制
```javascript
// 错误常量定义
export const TUN_ERRORS = {
  DEVICE_NOT_FOUND: 'DEVICE_NOT_FOUND',
  PERMISSION_DENIED: 'PERMISSION_DENIED',
  CONFIG_INVALID: 'CONFIG_INVALID',
  // ... 更多错误常量
}

// 错误映射函数
export function mapTunErrorToI18nKey(errorCode) {
  const errorMap = {
    [TUN_ERRORS.DEVICE_NOT_FOUND]: 'tun.errors.deviceNotFound',
    [TUN_ERRORS.PERMISSION_DENIED]: 'tun.errors.permissionDenied',
    // ... 更多映射关系
  }
  return errorMap[errorCode] || 'tun.errors.unknown'
}
```

### i18n资源结构
```json
{
  "serverList": {
    "messages": {
      "proxyModeChangedDesc": "代理模式已切换到 {mode}",
      "serverAddedDesc": "服务器 {name} 已成功添加",
      "testFailedDesc": "服务器 {name} 连接测试失败: {error}",
      // ... 更多消息键值
    }
  },
  "tun": {
    "errors": {
      "deviceNotFound": "未找到TUN设备，请检查驱动程序是否正确安装",
      "permissionDenied": "权限不足，请以管理员身份运行程序",
      // ... 更多错误翻译
    }
  }
}
```

### Rust错误处理优化
```rust
// 优化前：硬编码错误信息
return Err("Failed to create TUN device".to_string());

// 优化后：使用预定义常量
return Err(TUN_ERRORS.DEVICE_NOT_FOUND.to_string());
```
